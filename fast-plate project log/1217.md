# fast-plate project log

- 주제 : 망고플레이트 서비스 만들어보기 (https://www.mangoplate.com/)
- 조원 : 신창선, 조민지, 안재현
- 개발 일정 : 2018/12/03 ~ 2018/12/21

## 2018 / 12 / 17

### 첫번째 목표 : FacebookLoginView 컴포넌트에서 필요한 정보들을 UserContext로 옮겨 hoc로 만들어주기

- 페이스북에서 받아온 정보들은 컴포넌트 여러곳에서 쓰여야 하므로 FacebookLoginView 컴포넌트에서 UserContext로 초기 상태들을 옮겼다.
- 그런 뒤 FacebookLoginView를 UserContext의 withUser함수로 감싸준다.

  ```js
  // withUser hoc 함수
  function withUser(WrappedComponent) {
    return function WithUser(props) {
      return (
        <Consumer>
          {value => <WrappedComponent {...props} {...value} />}
        </Consumer>
      );
    };
  }

  // FacebookLoginView에서 로그인창 띄우는 컴포넌트
  <FacebookLogin
    appId={process.env.REACT_APP_FACEBOOK_KEY}
    autoLoad={true}
    fields="name,email,picture"
    callback={login}
    render={renderProps => (
      <div onClick={renderProps.onClick} className={cx("loginFacebook")}>
        <span className={cx("btnTitle")}>페이스북으로 시작하기</span>
      </div>
    )}
  />;

  // 맨 아래에 이렇게 hoc로 감싼다.
  export default withUser(FacebookLoginView);
  ```

- 이렇게 페이스북 로그인을 한 뒤에 받아온 정보들을 이런식으로 MypageView, PostDetailView 컴포넌트를 감싸준다.

### 두번째 목표 : 로그인 상태이면 리뷰쓰기 페이지가 나오게, 아니면 로그인창이 나오게 만들어주기

- 이쪽에서 많이 헤맸다.
- 페이스북에서 로그인을 하게되면 response에 로그인 한 유저의 데이터가 오게되는데 그 데이터로 만들어 주는 줄 알았지만...
- 그게 아니라 페이스북에서 데이터를 받게되면 그 데이터를 다시 api 서버로 POST 한 뒤에 유저를 등록하고, 그 정보를 GET으로 가져오는 원리였다.
- GET으로 api 서버에서 username을 가져올건데 그 username으로 로그인의 유무를 판단했다.
- 만일 username이 true이면 handleWritingReviewPage 메소드를 실행하고 아니라면 로그인 팝업창을 띄우는 showTargetElement를 불러오게 만들었다.

  ```js
  onClick={() => {
    username
      ? this.handleWritingReviewPage()
      : showTargetElement('popupOpen');
  }}

  ```

### 느낀점

- hoc를 처음 써봤다. 생각보다 사용하기 쉬웠고 유용했다.
- 이제 로그인하면 페이스북에서 받은 데이터를 api 서버에 POST하고 필요한 데이터를 GET한 뒤에 맞는곳에 뿌려주는 작업만 하면 프로젝트의 80퍼센트는 완성
