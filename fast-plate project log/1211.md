# fast-plate project log

- 주제 : 망고플레이트 서비스 만들어보기 (https://www.mangoplate.com/)
- 조원 : 신창선, 조민지, 안재현
- 개발 일정 : 2018/12/03 ~ 2018/12/21

## 2018 / 12 / 11

### 첫번째 목표 : 글자수 보여주기

- WritingReview 페이지에서 textbox에 글을 쓰게되면 10000자 이하로 제한이 되는데 (지금까지 쓴 글자) / 10000 이런식으로 아래 표시가 되는 기능을 만들어야했다.
- 처음엔 라이브러리를 이용해 사용할려고 했지만 마지막 업데이트가 2년전이라 설치를 해도 오류를 낸다.
- 때문에 stackoverflow를 참조하여 코드를 만들었다.
- container 컴포넌트인 WritingReview 컴포넌트 에서기존 상태인 chars_left에는 최대 글자수와 reviewTextBox에는 빈칸을 넣어놓았다.
- handleWordCount라는 메소드를 만들어 input이라는 변수에 사용자의 입력값을 할당한 다음 setState를 이용해서 chars_left의 상태를 글자 최대수 - input
- 그리고 reviewTextBox의 상태를 사용자의 입력값으로 설정해주었다.

  ```js
  handleWordCount(event) {
    let input = event.target.value;
    this.setState({
      chars_left: 10000 - input.length,
      reviewTextBox: event.target.value,
    });
  }
  ```

- 메소드를 presentational 컴포넌트인 WritingReviewView 컴포넌트에 props로 넘긴다음에 textarea 태그에 props로 받아온 handleWordCount 메소드를 onChange에 넣는다. 또한 value에 reviewTextBox를 textarea의 value로 지정하게 한다.
- 남은 글자수를 보여주는 기능을 만들기 위해 textarea 태그 아래에 p 태그를 만들고 그 안에 받아온 chars_left를 props로 넣어준다.
- textbox안에 value로 reviewTextBox를 지정해 줌으로써 사용자의 입력이 가능해지며 이와 동시에 chars_left에서 전체 글자에서 현재의 글자를 뺌으로써 남은 글자수 확인이 가능해진다.

  ```js
  <textarea
  type="text"
  maxLength="10000"
  value={reviewTextBox}
  required
  placeholder="Jominji님, 주문하신 메뉴는 어떠셨나요? 식당의 분위기와 서비스도 궁금해요!"
  onChange={handleWordCount}
  onClick={buttonActive}
  />
  <p className={cx('ReviewEditor__TextLengthStateBox')}>
  {this.props.chars_left.toLocaleString()} / 10,000
  </p>
  ```

- 참고 : https://stackoverflow.com/questions/33079204/how-to-create-a-twitter-like-remaining-characters-count-with-react

### 두번째 목표 : textbox에 입력이 되었을 때 '완료'버튼 활성화 시켜주기

- 이 목표는 위에 목표에서 만든 reviewTextBox를 통해 쉽게 해결했다.
- reviewTextBox가 빈 문자열이면 falsy값이므로 빈문자열이 아닐때는 버튼을 활성화 시키고 맞으면 비활성화 시키면된다.
- 보통은 위에서 변수에다가 삼항 연산자를 넣고 그 변수를 className값으로 넣어줌으로써 true상태와 false 상태를 스위치 시켰는데...
- css 모듈에서는 해본적이 없어 이번에는 조금 다르게했다. (이렇게 하는건 처음 알았다.)
  ```js
   <button
    className={cx(
      {
        ReviewWritingPage__SubmitButton_Active: reviewTextBox,
      },
      {
        ReviewWritingPage__SubmitButton_InActive: !reviewTextBox,
      }
    )}
    disabled={!reviewTextBox}
    onClick={postReview}
  >
  ```
- 객체의 키로 발동시키고자 하는 css의 이름을 넣고 그 값으로 true, false값을 넣었다.

### 세번째 목표 : 서버와 통신해서 WritingReviewView 페이지에 아이디 값에 맞는 식당이름 불러오기

- 통신쪽은 익숙치가 않아 전에 팀장이 미리 만들어 놓은 코드를 참고했다.
- 먼저 App 컴포넌트의 Route에서 해당되는 path의 뒤에 /:r 형식으로 변수를 만들어준다.
  ```js
  <Route
    path="/restaurantsReview/:rReviewKeyword"
    component={WritingReviewPage}
  />
  ```
- 다음으로 component에 연결되어있는 페이지 컴포넌트에서 그 값(match)을 props 로 받는다.
- 그 match 안에는 다양한 정보가 들어있는데 match.params.(App 컴포넌트에서 지정한 변수이름 예를들어 :rReviewKeyword)를 하게되면 그 페이지 고유의 아이디를 얻을 수 잇고 그 아이디를 변수에 저장한 뒤에 container 컴포넌트로 넘겨준다.
  ```js
  const { match } = this.props;
  console.log(match);
  const reviewId = match.params.rReviewKeyword;
  ```
- container 컴포넌트에서 서버로부터 가져오고자 하는 정보를 담기 위해 기존 상태에 빈 객체를 만들어준다.
- 페이지가 렌더링 되자마자 실행되어야 함으로 componentDidMount에서 필요한 정보들만을 추출한 뒤에 위에서 미리 만들어두었던 빈 객체의 상태를 변화시키자.

  ```js
  async componentDidMount() {
    const { reviewId } = this.props;
    const {
      data: { name, pk },
    } = await api.get(`/api/restaurants/list/${reviewId}`);
    this.setState({
      restaurantsName: name,
      restaurantsPk: pk,
    });
    console.log(reviewId);
  }
  ```

  이제 restaurantsName과 restaurantsPk에 필요한 정보를 얻었으니 WritingReviewView 컴포넌트에서 필요한 곳에 넣어주면 끝난다.

### 느낀점

- 항상 느끼는거지만 시간은 많이 지났으나 하루동안 생각하고 코드 친거에 비하면 별로 커다란 기능은 만들지 못했다.
- 하지만 서버와 통신하는것을 해보고 싶었는데 이제야 해보니까 전에 배웠던 내용들이 조금씩 생각난다.
- 문제는 get은 단순히 db에서 정보를 가져와서 보여주면 되는데... post나 patch는 어떻게 해야할지...
- 얼굴 아이콘을 선택한 뒤에 완료를 누르면 patch 메소드를 이용해서 db에 있는 평점을 업데이트 해줘야하는데... 안된다...
- 이것도 몇시간 동안 붙잡고 있다가 백엔드에서 만들어준 gitbook을 봤는데 없다... db에는 나오는데 설명서에는 나오지 않았다.
- 일단 백엔드에게 메세지는 보냈으니 내일 중으로 가능할것 같다.
- 그리고 내일 파일 업로드 기능도 업데이트 해야한다.
