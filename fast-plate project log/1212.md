# fast-plate project log

- 주제 : 망고플레이트 서비스 만들어보기 (https://www.mangoplate.com/)
- 조원 : 신창선, 조민지, 안재현
- 개발 일정 : 2018/12/03 ~ 2018/12/21

## 2018 / 12 / 12

### 첫번째 목표 : 업로드 한 이미지 프리뷰로 보여주기

- input의 타입을 file로 설정하고 이미지를 업로드 한 뒤에 어떠한 이미지를 업로드 했는지 프리뷰로 보여주는 기능을 만들어야했다.
- 먼저 상태를 이용해 container 컴포넌트에서 상태 하나(selectedFile)을 만들었다. (값은 null)
- 그 다음 fileSelectedHandler라는 메소드를 만들고 setState를 이용해 선택한 이미지 파일을 값으로 업데이트 해준다.(event.target.files[0])
- fileSelectedHandler를 presentational 컴포넌트에 있는 input의 onChange에 넣어준다.
- 이렇게 해서 console.log를 사용하게 되면 선택한 이미지의 이름이 콘솔창에 나오게 된다.
- 하지만 input도 있고 button도 있어서 보기 불편하다. input을 button처럼 활용할 수 있게 만들어보자
- input의 스타일을 display: 'none'으로 지정
- input에 ref를 이용해 ref={fileInput => (this.fileInput = fileInput)} 이렇게 설정한다.
- button의 onClick에 input의 ref 인수 이름을 함수로 넣고 뒤에 .click()을 넣어준다.
- 그러면 완성
  ```js
   <input
    style={{ display: 'none' }}
    type="file"
    onChange={fileSelectedHandler}
    ref={fileInput => (this.fileInput = fileInput)}
    onClick={event => {
      event.target.value = null;
    }}
  />
  <button
    onClick={() => this.fileInput.click()}
    className={cx('DraggablePictureContainer__PictureList')}
  >
    +
  </button>
  // +를 input 처럼 사용 가능하다.
  ```
- 이제 이미지를 여러개를 화면에 출력 시키기 위해 상태에 빈 배열을 만들어 준 뒤에 입력되는 이미지마다 배열에 들어가게 만들자.

  ```js
  fileSelectedHandler = event => {
    this.setState(
      {
        selectedFile: event.target.files[0],
        uploadImgArr: this.state.uploadImgArr.concat(
          URL.createObjectURL(event.target.files[0])
        )
      },

      () => {
        // 사진을 업로드하면 배열로 나온다. uploadImgArr 배열을 map으로 돌려서 img src에 보여주면 됨
        console.log(this.state.uploadImgArr);
      }
    );
  };

  {
    uploadImgArr.map((img, index) => (
      <img
        src={img}
        key={index}
        alt="uploaded-images"
        onClick={() => handleDeleteImg(index)}
      />
    ));
  }
  ```

- 한가지 팁으로 같은 이미지는 업로드가 되지 않는데 파일이 같을 경우 input에 onChange가 동작하지 않기 때문이다. 그러므로 input에 이벤트를 초기화 해주는 작업이 필요하다.

  ```js
   onClick={event => {event.target.value = null;}}
  ```

- 이미지를 클릭하면 배열에서 그 클릭된 이미지를 지우고 싶다. 그러면 이렇게 하면 된다.

  ```js
  handleDeleteImg(index) {
    const { uploadImgArr } = this.state;
    const newArr = uploadImgArr.filter((item, idx, arr) => {
      return item !== arr[index];
    });
    console.log(newArr);
    this.setState({
      uploadImgArr: newArr,
    });
  }
  // item과 arr[index]의 내용이 같지 않은것만을 이용해 배열을 새로 만든 뒤 기존 배열에 업데이트 해주는 방식
  ```

  참조 : https://academind.com/learn/react/snippets/image-upload/, https://medium.com/@650egor/react-30-day-challenge-day-2-image-upload-preview-2d534f8eaaa,
  https://stackoverflow.com/questions/47782281/react-file-uploader-does-not-trigger-when-same-file-is-update-twice?noredirect=1&lq=1

### 두번째 목표 : 리뷰 아이템 필터 만들어주기

- 1209.md 파일을 참조
- 다른점은 평가마다 다른 메서드 하나하나 만들어 주는 것이 아닌 인수를 이용해 한개로 여러 작업을 처리했다.

  ```js

  <li className={cx('review-filter-item')} onClick={() => handleReviewfilter(5)}>
  <li className={cx('review-filter-item')} onClick={() => handleReviewfilter(3)}>
  <li className={cx('review-filter-item')} onClick={() => handleReviewfilter(1)}>

  handleReviewfilter(n) {
    const { post_set } = this.state;
    this.setState({
      container: post_set.filter(element => {
        return element.rate === n;
      }),
    });
  }

  ```

### 세번째 목표 : WritingReview 컴포넌트에서 서버에 POST요청 보내기

- 어제 열심히 시도하다가 안됐다.
- 그런데 내가 잘못 생각했던게 있었던게 데이터를 보면 rate_good, rate_normal, rate_bad가 나오는데 이곳에다가 점수를 보내는 줄 알았다.
- 알고보니 post_set에 다양한 유저관련 정보가 들어있는데 그곳에 POST 요청을 해야되는 것이었다.
- rate\_ 삼형제들이 어디에다 쓰이는지는 오리무중... 금요일 스프린트 시간에 백엔드 팀에게 물어봐야겠다.

```
 "pk": 1,
   "name": "소문난성수감자탕",
   "address": "서울시 성동구 성수동2가 315-100",
   "phone_num": "02-465--6580",
   "food_type": "탕 / 찌개 / 전골",
   "price_level": "만원-2만원",
   "parking": "무료주차 가능",
   "Business_hour": "00:00 - 24:00",
   "break_time": "",
   "last_order": "",
   "holiday": "",
   "website": "",
   "youtube": "",
   "view_num": 0,
   "review_num": 0,
   "want_num": 38,
   "created_at": "2018-12-07T15:07:15.656185+09:00",
   "modified_at": "2018-12-12T17:19:29.527814+09:00",
   "latitude": 37.54278651,
   "longitude": 127.05440005,
   "rate_average": "3.67",
   "rate_good": 1,
   "rate_normal": 1,
   "rate_bad": 1,
   "menu_text": "감자국식사 7,500원",
   "menuimage_res": [],

   여기 안에  post_set이 있음
   "post_set": [
       {
           "pk": 1,
           "author": {
               "pk": 5,
               "username": "iu",
               "first_name": "",
               "last_name": "",
               "img_profile": "https://wps9thmango.s3.amazonaws.com/media/user/iu2.jpeg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIHYXHTMCJ7D5CKIA%2F20181212%2Fap-northeast-2%2Fs3%2Faws4_request&X-Amz-Date=20181212T132109Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Signature=e9b89d5da59a2626ca46586feb2c898b9e3a706770ce554608fa994a0cbaa27d",
               "phone": null,
               "email": "iu@iu.iu",
               "introduce": ""
           },
           "restaurant": 1,
           "rate": 3,
           "content": "언제나 가도 손님이 북적북적 좀 정신이 없는곳 심지어 중국 관광객도 오는듯\r\n감자탕은 맛남 그러나 양이 좀 작은듯 \r\n가끔씩 생각나는 곳\r\n감자국(₩ 7,000) 먹었는데 정말 최고의 한끼입니다. 깔끔하면서 진한 국물 맛이 일품이고, 같이 나오는 깍두기도 정말 시원하고 맛나요. 양도 든든해서 식사로 최고입니다!",
           "postimage_posts": []
       }]

```

- API 문서를 보면 POST 요청을 보낼때 author, restaurant, content, rate은 필수로 들어가야 한다고해서 상태에 더미 데이터를 만들었다.
- (API 문서에는 content가 아닌 context라고 쓰여져있는데 데이터에는 context가 없고 content가 있다.)
- 그래서 API 문서대로 POST 요청을 보냈는데...

  ```js
  async postReview() {
    const { goodOpen, okOpen, notGoodOpen } = this.state;
    const { author, restaurant, content, rate } = this.state;

    // if문은 얼굴 아이콘이 선택되지 않았을 때 실행된다.
    if (!goodOpen && !okOpen && !notGoodOpen) {
      alert('평가해 주세요');
    } else {
      const res = await api.post(`/api/posts/list`, {
        author,
        restaurant,
        content,
        rate,
      });
      console.log(res.config);
    }
  }
  ```

- 데이터에 들어있지가 않다. 팀장이 포스트맨으로 더미를 만들어서 보내봤지만 바뀌는건 없었다...
- 슬렉 채널에 올렸는데 아직까지는 답이 없다.

### 느낀점

- 이제 제법 프로젝트 완성한 티가 나기 시작한다. 아직까지 완성할려면 많이 남았지만 그래도 60퍼센트는 완성한것 같다.(내가 한건 아니지만...)
- 서버에 추가되지 않는게 아쉽지만 POST 요청을 직접 해봤다. 나름 뿌듯하다.
- 민지님을 통해 배웠는데 앞으로 같은 패턴의 메소드를 반복해서 쓰지말자. 인수를 받는 메소드를 만들어서 사용하자!
