# fast-plate project log

- 주제 : 망고플레이트 서비스 만들어보기 (https://www.mangoplate.com/)
- 조원 : 신창선, 조민지, 안재현
- 개발 일정 : 2018/12/03 ~ 2018/12/21

## 2018 / 12 / 19

### 첫번째 목표 : FacebookLogin 구현하기

- 이제 서버로 페이스북에서 받은 accessToken을 post 할 수 있기에 로그인 구현이 가능해졌다.
- 페북에서 받은 정보가 담겨있는 response에서 필요한 토큰값과 아이디 값을 로컬 스토리지에 저장해주기 -> 로컬 스토리지에 저장된 토큰값과 아이디값을 이용해 post 요청해주기 -> post를 하게 되면 우리측 api 서버에서 오는 정보들이 res에 담겨있는데 setState를 이용해 필요한 상태들의 res에 들어있는 값들을 이용해 업데이트 해주기

```js
login = async response => {
  // 페이스북으로부터 받은 응답 값을 로컬 스토리지에 저장
  localStorage.setItem("ftoken", response.accessToken);
  localStorage.setItem("fid", response.id);
  // 로컬 스토리지에 저장된 값으로 api 요청
  const res = await api.post("api/members/auth-token/facebook/", {
    access_token: localStorage.getItem("ftoken"),
    facebook_user_id: localStorage.getItem("fid")
  });

  // api 요청의 응답값으로 유저정보 업데이트
  this.setState({
    username: res.data.user.full_name,
    picture: res.data.user.img_profile
  });
};
```

### 두번째 목표 : FacebookLogout 구현하기

- 로그아웃 버튼을 누르면 로컬 스토리지에 저장되어있던 토큰과 아이디를 지우고 상태를 원래대로 돌려주면 된다.

  ```js
  // 로그아웃
  logout = () => {
    localStorage.removeItem("ftoken");
    localStorage.removeItem("fid");
    this.setState({
      username: null,
      picture: null
    });
    console.log(this.state.username);
  };
  ```

### 세번째 목표 : 새로고침을 해도 로그인 상태 유지하기

- 새로고침을 했을 때 이미 로컬 스토리지에 값들이 저장되어있으므로 그 값들을 페이스북에 보내고 상태를 업데이트만 하는 함수를 만들어 componentDidMount() 메소드에 로컬 스토리지 안에서 토큰의 유무에 따라 호출 해주면 된다.

```js
async componentDidMount() {
// 로그인 분기 처리
if (localStorage.getItem('ftoken')) {
this.refresh();
  }
}

// 사용자가 새로고침 눌렀을때 로그인 유지
refresh = async () => {
const res = await api.post('api/members/auth-token/facebook/', {
access_token: localStorage.getItem('ftoken'),
facebook_user_id: localStorage.getItem('fid'),
});
this.setState({
username: res.data.user.full_name,
picture: res.data.user.img_profile,
});
```

### 느낀점

- 처음으로 소셜로그인을 구현해봤다.
- 그렇게 어려운 작업은 아니었고 머릿속에 어떻게 하면 될지도 알았지만 이것을 어떻게 배치해야하나 때문에 시간이 조금 걸린거같다.
- 하지만 다음에 다시 하게되면 어렵지 않게 할 수 있을것같다.
- 로그인을 구현했지만 api 파일에 있는 토큰값은 로그인한 유저가 받아온 토큰값으로 바뀌지 않는데 계속 어드민 토큰으로 고정되어있다.
- 다른 여러가지도 남았지만 서버쪽에서 아직 작업중이라 시간에 맞춰 끝낼 수 있을지 모르겠다. (백엔드도 많이 고생하는거같다. 화이팅!)
